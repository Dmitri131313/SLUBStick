#!/usr/bin/bash
set -e
# insert kernel module
# sudo modprobe pkcs8_key_parser
# add pkey
openssl genrsa 4096 | openssl pkcs8 -topk8 -nocrypt -outform DER > ./data.der
key=$(cat ./data.der | keyctl padd asymmetric foo @s)
# show pkey
keyctl show
# test encrypt with pkey
echo AAAAAAAA > ./data
keyctl pkey_encrypt $key 0 ./data
